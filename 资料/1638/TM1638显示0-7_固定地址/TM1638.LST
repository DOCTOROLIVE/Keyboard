C51 COMPILER V8.15   TM1638                                                                02/05/2013 00:12:16 PAGE 1   


C51 COMPILER V8.15, COMPILATION OF MODULE TM1638
OBJECT MODULE PLACED IN TM1638.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE TM1638.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /****************************** (C) COPYRIGHT 2013 YQDZ **************************
   2          * ÎÄ  ¼þ  Ãû      : TM1638.C
   3          * ×÷      Õß      : YQDZ
   4          * ÌÔ  ±¦  µê      : http://zyqmcu.taobao.com
   5          * °æ      ±¾      : V1.1
   6          * ÈÕ      ÆÚ      : 2013/01/17
   7          * Ö÷  ¿Ø  MCU     : STC90C516RD+
   8          * Ö÷      Æµ      : 11.0592MHz
   9          * ±à  Òë  Æ÷      : Keil C51 V3.8
  10          * Ãè      Êö      : TM1638¿ØÖÆÊýÂë¹ÜÒÀ´Î´Ó0ÏÔÊ¾µ½7.
  11          *********************************************************************************/
  12          #include"REG52.H"
  13          #include"TM1638CMD.H"
  14          
  15          typedef unsigned char UINT8;                                                            /* ÀàÐÍ¶¨Òå */
  16          typedef unsigned int  UINT16; 
  17          
  18          /******************************** Òý½Å¶¨Òå **************************************
  19                                  µ¥Æ¬»ú            TM1638
  20                                   P20                STB
  21                                   P21                CLK
  22                                   P22                DIO                     
  23          ********************************************************************************/            
  24          sbit    STB = P2^2;                                                                     /* ¶¨ÒåTM1638Æ¬Ñ¡Ï
             -ß */
  25          sbit    CLK = P2^1;                                                                     /* ¶¨ÒåTM1638Ê±ÖÓÏ
             -ß */
  26          sbit    DIO = P2^0;                                                                     /* ¶¨ÒåTM1638Êý¾ÝÊ
             -äÈë£¬Êä³öÏß */
  27          
  28          /****************************** ¹²ÒõÊýÂë¹ÜÂë±í ********************************/
  29          const UINT8 CathodeCode[ 0x10 ] = {  0X3F, 0X06, 0X5B, 0X4F, 0X66, 0X6D, 0X7D, 
  30                                               0X07, 0X7F, 0X6F, 0X77, 0X7C, 0X39, 0X5E, 
  31                                               0X79, 0X71  };
  32                                               
  33          UINT8   KeyCode[4];                                                                     /* ±£´æ¼üÖµ */
  34          
  35          /*******************************************************************************
  36          * º¯  Êý  Ãû      : DelayUs
  37          * Ãè      Êö      : Î¢Ãë¼¶ÑÓÊ±.
  38          * Êä      Èë      : UINT16 Us£º
  39          *                   ÒªÑÓÊ±UsµÄÊ±¼ä.
  40          * ·µ      »Ø      : ÎÞ.
  41          *******************************************************************************/
  42          void DelayUs( UINT16 Us )
  43          {
  44   1              while(--Us);
  45   1      }
  46          
  47          /*******************************************************************************
  48          * º¯  Êý  Ãû      : DelayMs
  49          * Ãè      Êö      : ºÁÃë¼¶ÑÓÊ±.
  50          * Êä      Èë      : UINT16 Ms£º
  51          *                   ÒªÑÓÊ±µÄMsÊ±¼ä.
  52          * ·µ      »Ø      : ÎÞ.
C51 COMPILER V8.15   TM1638                                                                02/05/2013 00:12:16 PAGE 2   

  53          *******************************************************************************/
  54          void DelayMs( UINT16 Ms )
  55          {
  56   1              while( Ms-- )
  57   1              {
  58   2                      DelayUs(200);                                                                                                                                   /* 5´Î1ms */
  59   2                      DelayUs(200);
  60   2                      DelayUs(200);
  61   2                      DelayUs(200);
  62   2                      DelayUs(200);
  63   2              }
  64   1      }
  65          
  66          /*******************************************************************************
  67          * º¯  Êý  Ãû      : TM1638_WriteCmd
  68          * Ãè      Êö      : ÏòTM1638Ð´ÈëÃüÁî.
  69          * Êä      Èë      : UINT8 mCmd£º
  70          *                   Òª·¢ËÍµÄÃüÁî.
  71          * ·µ      »Ø      : ÎÞ.
  72          *******************************************************************************/
  73          void TM1638_WriteCmd( UINT8 mCmd )
  74          {
  75   1          UINT8 i;  
  76   1          
  77   1              STB = 0;                                                                            /* Ê¹ÄÜÆ¬Ñ¡ */
  78   1          for( i = 0; i < 8 ; i++ )
  79   1          {
  80   2              CLK = 0;                                                                        /* À­µÍCLK */
  81   2              DelayUs(1);
  82   2              if( mCmd & 0x01 ) DIO = 1;                                                      /* ·¢ËÍÊý¾Ýµ½ÐÅºÅÏ
             -ßÉÏ£¬DIOÊý¾ÝÏßÎª¸ß */
  83   2              else DIO = 0;                                                                   /* DIOÊý¾ÝÏßÎªµÍ *
             -/
  84   2              mCmd >>= 1;                                                                     /* Êý¾ÝÓÒÒÆÒ»Î» */
  85   2              CLK = 1;                                                                        /* À­¸ßCLK */
  86   2              DelayUs(1);
  87   2          }
  88   1              STB = 1;                                                                            /* ½ûÖ¹Æ¬Ñ¡ */
  89   1          DelayUs(2);
  90   1      }
  91          
  92          /*******************************************************************************
  93          * º¯  Êý  Ãû      : TM1638_WriteData
  94          * Ãè      Êö      : ÏòTM1638Ð´ÈëÊý¾Ý.
  95          * Êä      Èë      : UINT8 mDig:
  96          *                   ¶ÔÓ¦µÄÊýÂë¹ÜµØÖ·.
  97                                                  UINT8 mData£º
  98                                                  ¶ÔÓ¦µÄÊýÂë¹ÜÏÔÊ¾Êý¾Ý.
  99          * ·µ      »Ø      : ÎÞ.
 100          *******************************************************************************/
 101          void TM1638_WriteData( UINT8 mDig,  UINT8 mData )
 102          {
 103   1          UINT8 i;  
 104   1          UINT8 SendByte = 0;
 105   1          
 106   1              STB = 0;                                                                            /* Ê¹ÄÜÆ¬Ñ¡ */
 107   1          for( i = 0; i < 8 ; i++ )
 108   1          {
 109   2              CLK = 0;                                                                        /* À­µÍCLK */
 110   2              DelayUs(1);                                                                     /* ÑÓÊ±1us */
 111   2              if( mDig & 0x01 ) DIO = 1;                                                      /* ·¢ËÍÊý¾Ýµ½ÐÅºÅÏ
             -ßÉÏ£¬DIOÊý¾ÝÏßÎª¸ß */
C51 COMPILER V8.15   TM1638                                                                02/05/2013 00:12:16 PAGE 3   

 112   2              else DIO = 0;                                                                   /* DIOÊý¾ÝÏßÎªµÍ *
             -/ 
 113   2              mDig >>= 1;                                                                     /* Êý¾ÝÓÒÒÆÒ»Î» */
             -        
 114   2              CLK = 1;                                                                        /* À­¸ßCLK */
 115   2              DelayUs(1);
 116   2          }
 117   1      
 118   1          for( i = 0; i < 8 ; i++ )
 119   1          {
 120   2              CLK = 0;                                                                        /* À­µÍCLK */
 121   2              DelayUs(1);
 122   2              if( mData & 0x01 ) DIO = 1;                                                     /* ·¢ËÍÊý¾Ýµ½ÐÅºÅÏ
             -ßÉÏ£¬DIOÊý¾ÝÏßÎª¸ß */
 123   2              else DIO = 0;                                                                   /* DIOÊý¾ÝÏßÎªµÍ *
             -/ 
 124   2              mData >>= 1;                                                                    /* Êý¾ÝÓÒÒÆÒ»Î» */
 125   2              CLK = 1;                                                                        /* À­¸ßCLK */
 126   2              DelayUs(1);
 127   2          }
 128   1              STB = 1;                                                                            /* ½ûÖ¹Æ¬Ñ¡ */
 129   1          DelayUs(2);
 130   1      
 131   1      }
 132          
 133          /*******************************************************************************
 134          * º¯  Êý  Ãû      : main
 135          * Ãè      Êö      : Ö÷³ÌÐò.
 136          * Êä      Èë      : ÎÞ.
 137          * ·µ      »Ø      : ÎÞ.
 138          *******************************************************************************/
 139          void main( void )
 140          {
 141   1              DelayMs(100);                                                                                                                                           /* ÉÏµçÑÓÊ±,µÈ´ýÐ¾Æ¬Õý³£¹¤×÷ */
 142   1      
 143   1              TM1638_WriteCmd( ADDRESS_FIX_MODE );                                                /* µØÖ·¹Ì¶¨Ä£Ê½ */
 144   1              TM1638_WriteCmd( DISPLAY_ON );                                                      /* ¿ªÏÔÊ¾ */
 145   1      
 146   1              TM1638_WriteCmd( SET_PLUS_WIDTH4 );
 147   1      
 148   1              TM1638_WriteData( TM1638_DIG0, CathodeCode[0] );                                                                        /* µÚÒ»¸öÊýÂë¹ÜÏÔÊ¾0 */
 149   1              TM1638_WriteData( TM1638_DIG1, CathodeCode[1] );                                                                        /* µÚ¶þ¸öÊýÂë¹ÜÏÔÊ¾1 */
 150   1              TM1638_WriteData( TM1638_DIG2, CathodeCode[2] );                                                                        /* µÚÈý¸öÊýÂë¹ÜÏÔÊ¾2 */
 151   1              TM1638_WriteData( TM1638_DIG3, CathodeCode[3] );                                                                        /* µÚËÄ¸öÊýÂë¹ÜÏÔÊ¾3 */
 152   1              TM1638_WriteData( TM1638_DIG4, CathodeCode[4] );                                                                        /* µÚÎå¸öÊýÂë¹ÜÏÔÊ¾4 */
 153   1              TM1638_WriteData( TM1638_DIG5, CathodeCode[5] );                                                                        /* µÚÁù¸öÊýÂë¹ÜÏÔÊ¾5 */
 154   1              TM1638_WriteData( TM1638_DIG6, CathodeCode[6] );                                                                        /* µÚÆß¸öÊýÂë¹ÜÏÔÊ¾6 */
 155   1              TM1638_WriteData( TM1638_DIG7, CathodeCode[7] );                                                                        /* µÚ°Ë¸öÊýÂë¹ÜÏÔÊ¾7 */
 156   1      
 157   1              while(1);                                                                           /* Ò»Ö±ÔÚ´ËÑ­»· */
 158   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    269    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     20       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V8.15   TM1638                                                                02/05/2013 00:12:16 PAGE 4   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
